---
import StarlightSidebar from '@astrojs/starlight/components/Sidebar.astro'

import { getRecentBlogEntries } from '../libs/content'

const isBlogRoot = Astro.url.pathname.match(/^\/blog\/?$/)
const isBlogPage = Astro.url.pathname.startsWith('/blog')

const recentEntries = isBlogPage ? await getRecentBlogEntries() : []
---

{
  isBlogPage ? (
    <StarlightSidebar
      sidebar={[
        {
          href: '/blog',
          isCurrent: isBlogRoot,
          label: 'All posts',
          type: 'link',
        },
        {
          entries: recentEntries.map((blogEntry) => ({
            href: `/${blogEntry.slug}`,
            isCurrent: Astro.url.pathname.match(new RegExp(`^/${blogEntry.slug}/?$`)),
            label: blogEntry.data.title,
            type: 'link',
          })),
          label: 'Recent posts',
          type: 'group',
        },
      ]}
    />
  ) : (
    <StarlightSidebar {...Astro.props} />
  )
}
